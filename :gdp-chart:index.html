<!DOCTYPE html>
<html lang="da">
  <head>
    <meta charset="UTF-8" />
    <title>Verdens befolkning</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <style>
      .tooltip {
        position: absolute;
        text-align: center;
        background-color: white;
        border: solid 1px #ccc;
        border-radius: 5px;
        padding: 5px;
        font-family: sans-serif;
        font-size: 12px;
        pointer-events: none;
      }

      .node {
        cursor: grab;
      }
    </style>
  </head>
  <body>
    <h2
      style="text-align: center; font-family: sans-serif; margin-bottom: 10px"
    >
      Verdens befolkning fordelt p√• regioner
    </h2>

    <div id="my_dataviz"></div>

    <script>
      var width = 460;
      var height = 460;

      var svg = d3
        .select("#my_dataviz")
        .append("svg")
        .attr("width", width)
        .attr("height", height);

      // Tooltip
      var Tooltip = d3
        .select("body")
        .append("div")
        .attr("class", "tooltip")
        .style("opacity", 0);

      var mouseover = function (event, d) {
        Tooltip.style("opacity", 1);
      };

      var mousemove = function (event, d) {
        Tooltip.html(
          "<strong>" +
            d.country +
            "</strong><br/>" +
            d.value +
            " indbyggere<br/>" +
            "Region: " +
            d.region
        )
          .style("left", event.pageX + 15 + "px")
          .style("top", event.pageY - 28 + "px");
      };

      var mouseleave = function (event, d) {
        Tooltip.style("opacity", 0);
      };

      d3.csv(
        "https://raw.githubusercontent.com/holtzy/data_to_viz/master/Example_dataset/11_SevCatOneNumNestedOneObsPerGroup.csv"
      ).then(function (data) {
        data = data.filter((d) => +d.value > 10000000);

        var color = d3
          .scaleOrdinal()
          .domain(["Asia", "Europe", "Africa", "Oceania", "Americas"])
          .range(d3.schemeSet1);

        var size = d3.scaleLinear().domain([0, 1400000000]).range([7, 55]);

        var node = svg
          .append("g")
          .selectAll("circle")
          .data(data)
          .enter()
          .append("circle")
          .attr("class", "node")
          .attr("r", (d) => size(d.value))
          .attr("cx", width / 2)
          .attr("cy", height / 2)
          .style("fill", (d) => color(d.region))
          .style("fill-opacity", 0.8)
          .attr("stroke", "black")
          .style("stroke-width", 1)
          .on("mouseover", mouseover)
          .on("mousemove", mousemove)
          .on("mouseleave", mouseleave)
          .call(
            d3
              .drag()
              .on("start", dragstarted)
              .on("drag", dragged)
              .on("end", dragended)
          );

        var simulation = d3
          .forceSimulation()
          .force("center", d3.forceCenter(width / 2, height / 2))
          .force("charge", d3.forceManyBody().strength(0.1))
          .force(
            "collide",
            d3
              .forceCollide()
              .strength(0.2)
              .radius((d) => size(d.value) + 3)
              .iterations(1)
          );

        simulation.nodes(data).on("tick", () => {
          node.attr("cx", (d) => d.x).attr("cy", (d) => d.y);
        });

        function dragstarted(event, d) {
          if (!event.active) simulation.alphaTarget(0.03).restart();
          d.fx = d.x;
          d.fy = d.y;
        }

        function dragged(event, d) {
          d.fx = event.x;
          d.fy = event.y;
        }

        function dragended(event, d) {
          if (!event.active) simulation.alphaTarget(0.03);
          d.fx = null;
          d.fy = null;
        }
      });
    </script>
  </body>
</html>
